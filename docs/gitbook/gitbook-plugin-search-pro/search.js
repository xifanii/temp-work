require(["gitbook","jquery"],function(i,l){var o,u,c,h,p,d=500,e=i.state,s={},n=void 0!==history.pushState,t=l("body");function a(e){if(null!=e&&""!==e.trim()){var t,n=[],a=-1;for(var r in s)-1!==(a=s[r].body.toLowerCase().indexOf(e.toLowerCase()))&&n.push({url:r,title:s[r].title,body:s[r].body.substr(Math.max(0,a-50),d).replace(new RegExp("("+(t=e,String(t).replace(/([\*\.\?\+\$\^\[\]\(\)\{\}\|\/\\])/g,"\\$1"))+")","gi"),'<span class="search-highlight-keyword">$1</span>')});!function(s){o=l("#book-search-results"),u=o.find(".search-results-list"),c=o.find(".search-results-title"),h=c.find(".search-results-count"),p=c.find(".search-query"),o.addClass("open");var e=0==s.count;o.toggleClass("no-results",e),u.empty(),h.text(s.count),p.text(s.query),s.results.forEach(function(e){var t=l("<li>",{class:"search-results-item"}),n=l("<h3>"),a=l("<a>",{href:i.state.basePath+"/"+e.url+"?h="+encodeURIComponent(s.query),text:e.title,"data-is-search":1});a[0].href.split("?")[0]===location.href.split("?")[0]&&a[0].setAttribute("data-need-reload",1);var r=e.body.trim();r.length>d&&(r+="...");var o=l("<p>").html(r);a.appendTo(n),n.appendTo(t),o.appendTo(t),t.appendTo(u)}),l(".body-inner").scrollTop(0)}({count:n.length,query:e,results:n})}}function r(e){t.addClass("with-search"),t.addClass("search-loading"),function(n,a){var r;return function(){var e=this,t=arguments;r=r||setTimeout(function(){r=null,n.apply(e,t)},a)}}(function(){a(e),t.removeClass("search-loading")})()}function f(){t.removeClass("with-search"),l("#book-search-results").removeClass("open")}function v(){var e=l("body");e.on("keyup","#book-search-input input",function(e){if(13===e.keyCode&&n){var t=m("q",l(this).val());history.pushState({path:t},null,t)}!function(){var e=l("#book-search-input input").val();0==e.length?f():r(e)}()}),e.on("blur","#book-search-input input",function(e){if(n){var t=m("q",l(this).val());history.pushState({path:t},null,t)}})}i.events.on("start",function(){v(),l.getJSON(e.basePath+"/search_plus_index.json").then(function(e){s=e,b(),f()})});var g=function(e){l(".page-inner").mark(e,{ignoreJoiners:!0,acrossElements:!0,separateWordSearch:!1}),setTimeout(function(){var e=l('mark[data-markjs="true"]');e.length&&e[0].scrollIntoView()},100)};function b(){var e,t;/\b(q|h)=([^&]+)/.test(location.search)&&(t=RegExp.$1,e=decodeURIComponent(RegExp.$2),"q"===t?r(e):g(e),l("#book-search-input input").val(e))}function m(e,t){t=encodeURIComponent(t);var n,a=window.location.href.replace(/([?&])(?:q|h)=([^&]+)(&|$)/,function(e,t,n,a){return"&"===a?t:""}),r=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(r.test(a))return null!=t?a.replace(r,"$1"+e+"="+t+"$2$3"):(a=(n=a.split("#"))[0].replace(r,"$1$3").replace(/(&|\?)$/,""),void 0!==n[1]&&null!==n[1]&&(a+="#"+n[1]),a);if(null==t)return a;var o=-1!==a.indexOf("?")?"&":"?";return a=(n=a.split("#"))[0]+o+e+"="+t,void 0!==n[1]&&null!==n[1]&&(a+="#"+n[1]),a}i.events.on("page.change",b),window.addEventListener("click",function(e){"A"===e.target.tagName&&e.target.getAttribute("data-need-reload")&&setTimeout(function(){location.reload()},100)},!0)});